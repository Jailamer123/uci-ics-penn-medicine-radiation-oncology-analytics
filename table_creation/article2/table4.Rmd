---
title: "Table 4"
author: "Shawna Tuli and Jessica George"
date: "3/15/2021"
output: html_document
---

Libraries
```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(finalfit)
```

Data
```{r message=FALSE, warning=FALSE}
data <- read_csv("../data/data.csv") %>%
    mutate(init_performance_status = factor(case_when(as.numeric(init_performance_status) >= 90 ~ 1,
                          as.numeric(init_performance_status) < 90 ~ 0), levels = c(1, 0), labels = c(">=90", "<90")),
    age_cat = factor(age_cat, levels = c(1, 2, 3), labels = c("21-39", "40-59", ">60")),
    hiv_status = factor(hiv_status, levels = c(0, 1), labels = c("HIV-uninfected", "HIV-infected")),
    marital = factor(marital, levels = c(3, 1, 2), labels = c("Single", "Married/partnered", "Divorced/widowed")),
    total_chemo_received_0 = factor(forcats::fct_recode(factor(total_chemo_received), "0" = "0", "1" = "1", "1" = "2", "1" = "3", "1" = "4", "1" = "5", "1" = "6", "1" = "7"), labels = c("0", ">0")),
    total_chemo_received_4 = factor(forcats::fct_recode(factor(total_chemo_received), "0" = "0", "0" = "1", "0" = "2", "0" = "3", "1" = "4", "1" = "5", "1" = "6", "1" = "7"), labels = c("<4", ">=4")),
        combined_cancer_stage = factor(combined_cancer_stage, levels = c(0, 1, 2, 3, 4), labels = c("I (IB1*, IB2)", "I (IB1*, IB2)", "II (IIA, IIB)", "III (IIIA, IIIB)", "IV")),
    # combined_cancer_stage = factor(combined_cancer_stage, levels = c(1, 2, 3, 4), labels = c("I (IB1*, IB2)", "II (IIA, IIB)", "III (IIIA, IIIB)", "IV")),
    cd4_cat = factor(case_when(hiv_status == "HIV-uninfected" ~ 1,
                               hiv_status == "HIV-infected" & cd4_final >= 500 ~ 2, 
                               hiv_status == "HIV-infected" & cd4_final >= 350 & cd4_final < 500 ~ 3,
                               hiv_status == "HIV-infected" & cd4_final >= 200 & cd4_final < 350 ~ 4,
                               hiv_status == "HIV-infected" & cd4_final < 200 ~ 5), levels = c(1,2,3,4)),
    time_alive_path = time_alive_path/365
  )

label(data$age_cat) <- "Age"
label(data$hiv_status) <- "HIV Status"
label(data$cr_result) <- "Baseline Cr"
label(data$hb_result) <- "Baseline Hb"
label(data$eqd2) <- "EQD2"
label(data$combined_cancer_stage) <- "Disease stage"
label(data$total_chemo_received_0) <- "No. of chemo cycles received"
label(data$total_chemo_received_4) <- "No. of chemo cycles received"
```

Create Table 2
```{r}
all_explanatory <- c("init_performance_status", "marital", "alb_result", "distance", "age_cat", "hiv_status", "hb_result", "combined_cancer_stage")

all_explanatory2 <- c("init_performance_status", "age_cat", "hiv_status", "hb_result", "combined_cancer_stage")

dependent <- "Surv(time_alive_path, vital_status)"

# Table with chemo cycles (<4 & >=4)
data %>%
  finalfit(dependent, all_explanatory) %>%
  knitr::kable()

data %>%
  finalfit(dependent, all_explanatory2) %>%
  knitr::kable()

```
